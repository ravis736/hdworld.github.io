jQuery(document).ready(function($){

var typingTimer;
var doneTypingInterval = 500;
var $input = $('#tr_live_search');

$input.on('keyup', function (e) {
    if(e.keyCode != 13){
        $('#tr_live_search_content').html('<p class="trloading"><i class="fa-spinner fa-spin"></i>'+trlivesearch.loading)+'</p>';
        clearTimeout(typingTimer);
        typingTimer = setTimeout(trdoneTyping, doneTypingInterval);
    }
});

$input.on('keydown', function (e) {
    if(e.keyCode != 13){
        clearTimeout(typingTimer);
    }
});

function trdoneTyping () {

    var value = $input.val();
    var count = value.length;
    
    if(count<3){
        $('.TrCloseLive').find('button').removeClass('fa-spinner fa-spin').addClass('AAIco-clear');
        $('#tr_live_search_content').removeClass('On');
        $('#tr_live_search_content').html('<p class="trloading"><i class="fa-spinner fa-spin"></i>'+trlivesearch.loading)+'</p>';
    }

    if(count>=3){

        $('.TrCloseLive').find('button').removeClass('AAIco-clear').addClass('fa-spinner fa-spin');
        
        $.post( trlivesearch.url, { nonce: trlivesearch.nonce, action: trlivesearch.action, trsearch: value })
          .done(function( data ) {
            $('#tr_live_search_content').html(data);
            $('#tr_live_search_content').addClass('On');
            $('.TrCloseLive').find('button').removeClass('fa-spinner fa-spin').addClass('AAIco-clear');
                $(".Result .MovieListTop").mousewheel(function(a, b) {
                    this.scrollLeft -= b * 30;
                    a.preventDefault()
                });
        });

    }

}
    
function trcloselive(){
    $('#tr_live_search_content').html('<p class="trloading"><i class="fa-spinner fa-spin"></i>'+trlivesearch.loading)+'</p>';
    $('#tr_live_search_content').removeClass('On');
    $('#tr_live_search').val('');
    $('.TrCloseLive').find('button').removeClass('fa-spinner fa-spin').addClass('AAIco-clear');
}

$( ".TrCloseLive" ).click(function() {
    trcloselive();
});
    
$(document).on('click', function(e){
    if ($(e.target).closest('#tr_live_search_content').length === 0) {
        trcloselive();
    }
});

});